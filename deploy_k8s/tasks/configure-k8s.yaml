---
- name: "Initialize first control plane"
  ansible.builtin.shell: kubeadm init --pod-network-cidr=10.244.0.0/16 > kubeadm.secret # --control-plane-endpoint={{ ansible_hostname }}
  when: first_control_plane == "yes"
- name: update bash-completion
  ansible.builtin.shell:
    kubectl completion bash > /usr/share/bash-completion/completions/kubectl
- name: Prepearing to use
  ansible.builtin.shell:
    mkdir -p $HOME/.kube && sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config && sudo chown $(id -u):$(id -g) $HOME/.kube/config
  become: false
- name: Install CNI
  become: false
  ansible.builtin.shell:
    kubectl create -f {{ cni_url }}
- name: Disable control-node taint
  become: false
  ansible.builtin.shell:
    kubectl taint nodes --all node-role.kubernetes.io/control-plane-